<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="A text annotation and visualization tool">

    <title>Rhyme-Scheme Visualizer</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    
    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
        
const textareaStyle = {
    width: '400px',
    height: '400px'
 };

const buttonStyle = {
  border: 'none',
  color: 'blue',
  cursor: 'pointer'
}

const displayStyle = {
    float: "left",
    height: "700px"
}
/*
const matrixStyle = {
    width: "1000px",
    height: "1000px"
}*/

function SSArray(props) {
  var ssArray = Array(props.arrayColors.length);
  const ourLineHeight = (Math.floor(500/props.arrayColors.length) + 1).toString() + "px";
  const squareSize = (Math.floor(500/props.arrayColors.length)).toString() + "px";
  const arrayStyle = {
      lineHeight: ourLineHeight
  };
    for (var i = 0; i < props.arrayColors.length; i++) {
      //console.log("a");
      //console.log(i);
      ssArray[i] = Array(props.arrayColors.length);
      for (var j = 0; j < props.arrayColors.length; j++) {
        //console.log("b");
        //console.log(j);
        if (props.arrayColors[i] === props.arrayColors[j]) {
          //console.log("c");
          ssArray[i][j] = {
            display:"block",
            float: "left",
            background: props.arrayColors[j],
            width: squareSize,
            height: squareSize
          };
        }
        else {
          //console.log("d");
          ssArray[i][j] = {
            display:"block",
            float: "left",
            background:"white",
            width: squareSize,
            height: squareSize
          };
        }
      }
    }
    //console.log("z");
    const output = ssArray.map((anArray, index1) => {return (<div key={index1} style={arrayStyle}> {anArray.map((aStyle, index2)=>  {return (<span key={index2} style={aStyle}/>);})}<br/> </div>);});
    return output;
}

function ArrayBlock(props) {
    const output = props.textArray.map((string, index) => {
      if (string == "<br/>") {
        return (<br key={index}/>);
      }
      else {
        return(<WordToColor key={string + index.toString()} id={index} text={string}
                          color={props.color} changeArray = {props.changeArray}/>
        );
      }
      });
    return (<div>{output}</div>);
  
}

class AnnotationBlock extends React.Component {
  constructor(props) {
    super(props);
    //console.log(props.textArray);
    this.state= { 
      text:props.startText,
      textArray:props.textArray,
      arrayBlock:<ArrayBlock textArray={["hi"]} color="green" changeArray={this.changeArray}/>,
      inProgressColor:"red",
      color:props.color,
      input:true
    };
    this.arrayColors = ["green"];
    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
    this.handleColorSubmit = this.handleColorSubmit.bind(this);
    this.changeArray = this.changeArray.bind(this);
  }
  
  handleChange(event) {
    //console.log("here1");
    this.setState({[event.target.name]: event.target.value});
    //console.log("there1");
  }
  
  
  handleColorSubmit(event) {
    /*console.log("hi");
    console.log(this.state.text);
    console.log("done");*/
    this.setState({
      color:this.state.inProgressColor
    }, ()=>{console.log("updating" + this.state.color);
      this.setState({
        arrayBlock:<ArrayBlock textArray={this.state.textArray} color={this.state.color} changeArray={this.changeArray}/>
      });console.log("Should be done");
    });
    //console.log(this.state.color);
    event.preventDefault();
  }
  
  concatArrays(array1, array2) {
    return array1.concat(array2);
  }

  handleSubmit(event) {
    
    //console.log("here");
    const intermediate = this.state.text.replace(/\n/g, " <br/> ");
    const ar = intermediate.split(" ");
    //console.log(ar);
    this.setState({
      textArray: ar
    }, ()=>{this.arrayColors = this.state.textArray.map((string) => {return "white";}); 
            this.setState({
              arrayBlock: <ArrayBlock textArray={this.state.textArray} color={this.state.color} changeArray={this.changeArray}/>
            });
        });
    event.preventDefault();
    this.setState( {
        input: false
    });
  }
  
  changeArray(id, color) {
     //console.log("changing color");
     this.arrayColors[id] = color;
     this.setState({
       color: this.state.color
     });
  }
   
  render() {
    //console.log(this.state.textArray);
    if (this.state.input) {
       return (
   
      <div style={displayStyle}><form onSubmit={this.handleSubmit}>
        <label>
          Text:
          <textarea value={this.state.text} name="text" onChange={this.handleChange} style={textareaStyle}/>
        </label>
        <input type="submit" value="Submit" />
      </form>
      </div>
        );
    }
    else {
        return (
        <div>
        <button onClick={() => {this.setState(
            {
                input: true
            }
        );}}>Return to input</button>
        <div>
            <form onSubmit={this.handleColorSubmit}>
            <label>
              Color:
              <input type="text" name="inProgressColor" value={this.state.inProgressColor} onChange={this.handleChange} />
            </label>
            <input type="submit" value="Submit" />
            </form>
          <ArrayBlock textArray={this.state.textArray} color={this.state.color} changeArray={this.changeArray}/>
          </div>
            <div><SSArray arrayColors={this.arrayColors}/></div>
            </div>
        );
    }
    
  }
  
}

class WordToColor extends React.Component {
  constructor(props) {
    super(props);
    this.state={
      color: props.color,
      buttonStyle: {
        border: "none",
        background:"white",
        color: "black",
        display: "inline-block"
      }
      
    };
    
    this.handleClick = this.handleClick.bind(this);
    
  }
  
  handleClick(e) {
    this.setState({
      color: this.props.color,
    },()=>{this.setState({
              buttonStyle: {
                border: "none",
                background:"white",
                color: this.state.color,
                display: "inline-block"
              }});
          });
    this.props.changeArray(this.props.id, this.props.color);
    e.preventDefault();
  }
  
  render() {
    
     return (
       <button onClick={this.handleClick} style={this.state.buttonStyle}>{this.props.text}</button>
     );
  }
}


ReactDOM.render(
  <AnnotationBlock startText="" color="red" textArray={[""]}/>,
  //<SSArray arrayColors={["#ad1453","red","red","red","red","red","blue","#ad1453"]}/>,
  //<WordToColor key="hi" text="Destruction" color="green"/>,
  //<ArrayBlock textArray={["Hello", "World"]} color="blue" changeArray={()=>{console.log("chan");}}/>,
  document.getElementById('root')
);
    </script>
    <!--
      Note: this page is a great way to try React but it's not suitable for production.
      It slowly compiles JSX with Babel in the browser and uses a large development build of React.

      Read this section for a production-ready setup with JSX:
      https://reactjs.org/docs/add-react-to-a-website.html#add-jsx-to-a-project

      In a larger project, you can use an integrated toolchain that includes JSX instead:
      https://reactjs.org/docs/create-a-new-react-app.html

      You can also use React without JSX, in which case you can remove Babel:
      https://reactjs.org/docs/react-without-jsx.html
    -->
  </body>
</html>